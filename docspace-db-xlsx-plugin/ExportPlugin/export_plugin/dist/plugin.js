(()=>{"use strict";var t={};({156(t,n){var e=this&&this.__assign||function(){return e=Object.assign||function(t){for(var n,e=1,i=arguments.length;e<i;e++)for(var r in n=arguments[e])Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r]);return t},e.apply(this,arguments)},i=this&&this.__awaiter||function(t,n,e,i){return new(e||(e=Promise))(function(r,a){function o(t){try{s(i.next(t))}catch(t){a(t)}}function l(t){try{s(i.throw(t))}catch(t){a(t)}}function s(t){var n;t.done?r(t.value):(n=t.value,n instanceof e?n:new e(function(t){t(n)})).then(o,l)}s((i=i.apply(t,n||[])).next())})},r=this&&this.__generator||function(t,n){var e,i,r,a,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function l(l){return function(s){return function(l){if(e)throw new TypeError("Generator is already executing.");for(;a&&(a=0,l[0]&&(o=0)),o;)try{if(e=1,i&&(r=2&l[0]?i.return:l[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,l[1])).done)return r;switch(i=0,r&&(l=[2&l[0],r.value]),l[0]){case 0:case 1:r=l;break;case 4:return o.label++,{value:l[1],done:!1};case 5:o.label++,i=l[1],l=[0];continue;case 7:l=o.ops.pop(),o.trys.pop();continue;default:if(!((r=(r=o.trys).length>0&&r[r.length-1])||6!==l[0]&&2!==l[0])){o=0;continue}if(3===l[0]&&(!r||l[1]>r[0]&&l[1]<r[3])){o.label=l[1];break}if(6===l[0]&&o.label<r[1]){o.label=r[1],r=l;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(l);break}r[2]&&o.ops.pop(),o.trys.pop();continue}l=n.call(t,o)}catch(t){l=[6,t],i=0}finally{e=r=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([l,s])}}};Object.defineProperty(n,"__esModule",{value:!0});var a={uiUrl:"http://localhost:5173",backendUrl:"",dataUrlTemplate:"",tables:""};function o(t){return String(t||"").trim().replace(/\/$/,"")}var l=new(function(){function t(){var t=this;this.status="active",this.origin="",this.proxy="",this.prefix="",this.adminPluginSettings=null,this.adminSettingsValue=e({},a),this.uiUrlDraft=a.uiUrl,this.backendUrlDraft=a.backendUrl,this.dataUrlTemplateDraft=a.dataUrlTemplate,this.tablesDraft=a.tables,this.mainButtonItems=new Map,this.onLoadCallback=function(){return i(t,void 0,void 0,function(){return r(this,function(t){return[2]})})},this.updateStatus=function(n){t.status=n},this.getStatus=function(){return t.status},this.setOnLoadCallback=function(n){t.onLoadCallback=n},this.setOrigin=function(n){t.origin=n},this.getOrigin=function(){return t.origin},this.setProxy=function(n){t.proxy=n},this.getProxy=function(){return t.proxy},this.setPrefix=function(n){t.prefix=n},this.getPrefix=function(){return t.prefix},this.setAPI=function(n,e,i){t.origin=n,t.proxy=e,t.prefix=i},this.getAPI=function(){return{origin:t.origin,proxy:t.proxy,prefix:t.prefix}},this.getAdminPluginSettings=function(){return t.adminPluginSettings},this.setAdminPluginSettings=function(n){t.adminPluginSettings=n},this.setAdminPluginSettingsValue=function(n){t.adminSettingsValue=function(t){if(!t)return e({},a);try{var n=JSON.parse(t);return{uiUrl:o(n.uiUrl)||a.uiUrl,backendUrl:o(n.backendUrl)||a.backendUrl,dataUrlTemplate:String(n.dataUrlTemplate||"").trim(),tables:String(n.tables||"").trim()}}catch(t){return e({},a)}}(n),t.uiUrlDraft=t.adminSettingsValue.uiUrl,t.backendUrlDraft=t.adminSettingsValue.backendUrl,t.dataUrlTemplateDraft=t.adminSettingsValue.dataUrlTemplate,t.tablesDraft=t.adminSettingsValue.tables,t.configureSettingsUi(),t.configureMainButton()},this.addMainButtonItem=function(n){t.mainButtonItems.set(n.key,n)},this.getMainButtonItems=function(){return t.mainButtonItems},this.updateMainButtonItem=function(n){t.mainButtonItems.set(n.key,n)},this.configureSettingsUi(),this.configureMainButton()}return t.prototype.buildSettingsBox=function(){var t=this;return{displayProp:"flex",flexDirection:"column",paddingProp:"0",children:[{component:"text",props:{text:"Configure URLs and HTTP data source.",fontSize:"13px"}},{component:"text",props:{text:"UI URL",fontSize:"12px"}},{component:"input",props:{value:this.uiUrlDraft,placeholder:a.uiUrl,size:"middle",onChange:function(n){t.uiUrlDraft=n}},contextName:"uiUrlInput"},{component:"text",props:{text:"Backend URL (optional)",fontSize:"12px"}},{component:"input",props:{value:this.backendUrlDraft,placeholder:"",size:"middle",onChange:function(n){t.backendUrlDraft=n}},contextName:"backendUrlInput"},{component:"text",props:{text:"Data URL template (use {table})",fontSize:"12px"}},{component:"input",props:{value:this.dataUrlTemplateDraft,placeholder:"https://example.com/api/data?table={table}",size:"middle",onChange:function(n){t.dataUrlTemplateDraft=n}},contextName:"dataUrlTemplateInput"},{component:"text",props:{text:"Tables (comma separated)",fontSize:"12px"}},{component:"input",props:{value:this.tablesDraft,placeholder:"public.users, public.orders",size:"middle",onChange:function(n){t.tablesDraft=n}},contextName:"tablesInput"}]}},t.prototype.buildSettingsSaveButton=function(){var t=this,n={uiUrl:o(this.uiUrlDraft)||a.uiUrl,backendUrl:o(this.backendUrlDraft)||a.backendUrl,dataUrlTemplate:String(this.dataUrlTemplateDraft||"").trim(),tables:String(this.tablesDraft||"").trim()},e=JSON.stringify(n);return{button:{label:"Save",size:"normal",primary:!0,onClick:function(){return t.adminSettingsValue=n,t.uiUrlDraft=n.uiUrl,t.backendUrlDraft=n.backendUrl,t.dataUrlTemplateDraft=n.dataUrlTemplate,t.tablesDraft=n.tables,t.configureMainButton(),{actions:["save-settings","show-toast","update-main-button-items"],settings:e,toastProps:[{type:"success",title:"Plugin settings updated."}]}}},settingsJson:e}},t.prototype.configureSettingsUi=function(){var t=this.buildSettingsBox(),n=this.buildSettingsSaveButton().button;this.adminPluginSettings={settings:t,saveButton:{component:"button",props:n}}},t.prototype.buildModalDialog=function(t){var n=this,e={displayProp:"flex",flexDirection:"column",children:[{component:"iFrame",props:{src:t,width:"100%",height:"720px",id:"exportplugin-iframe"}}]};return{displayType:"modal",dialogHeader:"DB → XLSX Export",dialogBody:e,autoMaxWidth:!0,autoMaxHeight:!0,fullScreen:!1,onClose:function(){return{}},onLoad:function(){return i(n,void 0,void 0,function(){return r(this,function(t){return[2,{newDialogBody:e}]})})}}},t.prototype.configureMainButton=function(){var t=this,n=this.adminSettingsValue,e=n.uiUrl,a=n.backendUrl,o=n.dataUrlTemplate,l=n.tables,s=new URL(e);a&&s.searchParams.set("backendUrl",a),o&&s.searchParams.set("dataUrlTemplate",o),l&&s.searchParams.set("tables",l);var u={key:"exportplugin-open",label:"DB → XLSX",icon:"icon.svg",onClick:function(){return i(t,void 0,void 0,function(){return r(this,function(t){return[2,{actions:["show-modal"],modalDialogProps:this.buildModalDialog(s.toString())}]})})}};this.mainButtonItems.set(u.key,u)},t}());window.Plugins=window.Plugins||{},window.Plugins.Exportplugin=l,n.default=l}})[156].call(t,0,t)})();